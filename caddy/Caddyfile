# If accessed outside the local network redirect bitwarden admin page to the main vault
(admin_redirect) {
  @admin {
    path /pwd/admin*
    not remote_ip private_ranges
  }
  redir @admin /pwd/
}

{
  log {
    level INFO
    output file "/log/access.log" {
      roll_size 10MB
      roll_keep 10
    }
  }
}

{$DOMAIN_NAME}:443 {
  tls {$EMAIL}
  encode gzip

  import admin_redirect

  route {
    reverse_proxy /pwd/notifications/hub vaultwarden:3012
    reverse_proxy /pwd/* vaultwarden:80 {
      header_up X-Real-IP {remote_host}
    }
    handle /* {
      abort
    }
  }
}
